# 역할(role), 책임(responsibility), 협력(collaboration)
지난 장에서 학습한 클래스, 상속, 지연 바인딩(동적 바인딩) 등은 객체지향을 구현하는 측면에 치우쳐져 있다.
객체지향의 본질은 협력하는 객체들의 공동체를 창조하는 것이다.
객체지향 설계의 핵심은 협력을 구성하기 위해 적절한 객체를 찾고 적절한 책임을 할당하는 과정에서 드러난다.
클래스와 상속은 객체들의 책임과 협력이 어느 정도 자리를 잡은 후에 사용할 수 있는 구현 메커니즘일 뿐이다.

## 협력
### 영화 예매 시스템 돌아보기
우리가 앞서 만든 영화 예매 시스템을 통해 영화를 예매하는 데에는 많은 객체들이 참여하여 협력한다.

```
1.-> [reserve(customer, audienceCount)] Screening 5.-> return new Reservation()
        2.-> [calculateMovieFee(screening)] Movie 3.-> [calculateDiscountAmount(screening)] DiscountPolicy 
                                                            4.-> [isSatisfied(screening)] DiscountCondition
``` 
위 흐름을 보면 알 수 있듯이, 객체지향 원칙을 따르는 애플리케이션의 제어 흐름은 어떤 하나의 객체에 의해 통제되지 않고 다양한 객체들 사이에 균형 있게 분배되는 것이 일반적이다.
객체들은 영화 예매라는 기능을 구현하기 위해 메시지를 주고받으면서 상호작용하는데, 이를 `협력`이라고 한다.
객체가 협력에 참여하기 위해 수행하는 로직은 `책임`이라고 부른다.
객체들이 협력 안에서 수행하는 책임들이 모여 객체가 수행하는 `역할`을 구성한다.

### 협력
객체지향 시스템은 자율적인 객체들의 공동체다. 고립된 존재가 아니라 시스템의 기능이라는 더 큰 목표를 달성하기 위해 다른 객체와 협력하는 사회적인 존재이다.
협력은 객체지향의 세계에서 기능을 구현할 수 있는 유일한 방법이다. `메시지 전송(message sending)`은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단이다.

메시지를 수신한 객체는 메서드를 실행해 요청에 응답한다. 객체는 메시지를 처리할 방법을 스스로 선택한다.
외부의 객체는 오직 메시지만 전송할 수 있을 뿐이며 메시지를 어떻게 처리할지는 메시지를 수신한 객체가 직접 결정한다.
이것은 객체가 자신의 일을 스스로 처리할 수 있는 자율적인 존재라는 것을 의미한다.

```
Screening -> [calculateMovieFee(screening)] Movie
```
위는 영화 예매 요금을 계산하기 위한 Screening 과 Movie 의 협력을 나타낸 것이다.
Screening 이 Movie 에게 처리를 위임하는 이유는 요금을 계산하는 데 필요한 기본 요금과 할인 정책을 가장 잘 알고 있는 객체가 Movie 이기 때문이다.

만약 Screening 이 직접 처리를 하고자 한다면 Movie 의 fee 와 discountPolicy 를 직접 알아야 할텐데, 이는 Movie 의 캡슐화를 부순다.
또한 Movie 의 자율성이 훼손된다. 자율적인 객체는 자신의 상태를 직접 관리하고 스스로의 결정에 따라 행동해야 한다.

따라서 계산을 위임함으로써 Movie 의 내부 구현을 캡슐화하고 자율성을 보장하고, Screening 과 Movie 의 결합도를 느슨하게 유지할 수 있다.
Movie 내부 구현의 파급효과를 억제할 수 있는 것이다.

자율적인 객체는 자신에게 할당된 책임을 수행하던 중에 필요한 정보를 알지 못하거나 외부의 도움이 필요한 경우, 적절한 객체에게 메시지를 전송에서 협력을 요청한다.
메시지를 수신한 객체 역시 메시지를 처리하던 중에 직접 처리할 수 없는 정보나 행동이 필요한 경우 또 다른 객체에게 도움을 요청한다.

### 협력이 설계를 위한 문맥을 결정한다.
객체지향은 객체를 중심에 놓는 프로그래밍 패러다임이다. 여기서 객체란 상태와 행동을 함께 캡슐화하는 실행 단위다.
그렇다면 객체가 가질 수 있는 상태와 행동을 어떤 기준으로 결정해야 할까?

객체의 행동을 결정하는 것은 객체가 참여하고 있는 협력이다. 협력이 바뀌면 객체가 제공해야 하는 행동 역시 바뀌어야 한다.
협력은 객체가 필요한 이유와 객체가 수행하는 행동의 동기를 제공한다.

Movie 를 예로 들어보자. Movie 하면 직관적으로는 play, 즉 상영이라는 문구가 떠오른다. (적어도 나는 그렇다 ㅋㅋ)
그런데 우리가 작성한 코드에 상영 관련은 없고, 오로지 요금 계산 관련 코드만 있다.
이것은 Movie 가 영화를 예매하기 위한 협력에 참여하고 있고, 그 안에서 요금을 계산하는 책임을 지고 있기 때문이다.

협력이라는 문맥을 고려하자. 협력이 존재하기 때문에 객체가 존재하는 것이다.

객체의 행동을 결정하는 것이 협력이라면 객체의 상태를 결정하는 것은 행동이다. 행동을 수행하는 데 필요한 정보가 무엇인지로 결정된다.
Movie 객체가 기본 요금인 fee 와 할인 정책인 discountPolicy 를 가지고 있는 이유이다.

상태는 객체가 행동하는 데 필요한 정보에 의해 결정되고, 행동은 협력 안에서 객체가 처리할 메시지로 결정된다.
결과적으로 객체가 참여하는 협력이 행동과 상태를 모두 구성한다. 따라서 협력은 객체를 설계하는 데 필요한 일종의 `문맥(context)`을 제공한다.

## 책임
### 책임이란 무엇인가
협력이 갖추어졌으면, 다음으로 할 일은 협력에 필요한 행동을 수행할 수 있는 적절한 객체를 찾는 것이다.
이때 협력에 참여하기 위해 객체가 수행하는 행동을 `책임`이라고 부른다.

책임이란 객체에 의해 정의되는 응집도 있는 행위의 집합으로, 객체가 유지해야 하는 정보와 수행할 수 있는 행동에 대해 개략적으로 서술한 문장이다.
즉, 객체의 책임은 `무엇을 알고 있는가(knowing)`와 `무엇을 할 수 있는가(doing)`로 구성된다.

* 하는 것 doing
  * 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
  * 다른 객체의 행동을 시작시키는 것
  * 다른 객체의 활동을 제어하고 조절하는 것
* 아는 것 knowing
  * 사적인 정보에 관해 아는 것
  * 관련된 객체에 관해 아는 것
  * 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

`Screening`의 책임은 무엇인가? 영화를 예매하는 것이다(doing). 또한 자신이 상영할 영화를 알고 있어야 한다.(knowing)
`Movie`의 책임은 무엇인가? 요금을 계산하는 것이다(doing). 기본 가격과 할인 정책을 알고 있어야 한다.(knowing)

일반적으로 책임과 메시지의 크기는 다르다. 책임은 객체가 수행할 수 있는 행동을 종합적이고 간략하게 서술하기 때문에 메시지보다 추상적이고 개념적으로도 더 크다.

객체는 어떤 책임을 수행하기 위해서 그 책임을 수행하는 데 필요한 정보도 함께 알아야 할 책임이 있다.
책임은 객체지향 설게의 핵심이다. 협력이 중요한 이유는 객체에게 할당할 책임을 결정할 수 있는 문맥을 제공하기 때문이다.
적절한 협력이 적절한 책임을 제공하고, 적절한 책임을 적절한 객체에 할당해야 단순하고 유연한 설계를 창조할 수 있다.

### 책임 할당
자율적인 객체를 만드는 가장 기본적인 방법은 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것이다.
이를 책임 할당을 위한 `Information Expert(정보 전문가)` 패턴이라고 부른다.

협력에 필요한 지식과 방법을 가장 잘 알고 있는 객체에게 도움을 요청한다. 요청에 응답하기 위해 필요한 이 행동이 객체가 수행할 책임으로 이어지는 것이다.
따라서 객체에게 책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의해야 한다.
협력에 필요한 메시지를 찾고 메시지를 수행할 적절한 객체를 선택하는 반복적인 과정을 통해 객체지향 설계가 이뤄지고, 이런 메시지가 메시지를 수신할 객체의 책임을 결정한다.

또한 위 과정을 통해 결정된 메시지가 객체의 퍼블릭 인터페이스를 구성한다.

### 책임 주도 설계
책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법을 `책임 주도 설계(Responsibility-Driven Design, RDD)`라고 부른다.
협력은 객체를 설계하기 위한 구체적인 문맥을 제공하고, 책임을 이끌어낸다. 이후 책임은 협력에 참여할 객체를 결정한다.
책임 주도 설계는 자연스럽게 객체의 구현이 아닌 책임에 집중할 수 있게 한다.
구현이 아닌 책임에 집중하는 것이 중요한 이유는 유연하고 견고한 객체지향 시스템을 위해 가장 중요한 재료가 바로 책임이기 때문이다.

### 메시지가 객체를 결정한다.
객체에게 책임을 할당하는 데 필요한 메시지를 식별하고 메시지를 처리할 객체를 나중에 선택하자. 메시지가 객체를 선택하게 해야하는 두 가지 중요한 이유는 아래와 같다.

1. 객체가 최소한의 인터페이스를 가질 수 있게 된다.
필요한 메시지가 식별될 때까지 객체의 퍼블릭 인터페이스에 어떤 것도 추가하지 않기 때문이다.
2. 객체는 충분히 추상적인 인터페이스를 가질 수 있게 된다.
객체의 인터페이스는 무엇을 하는지는 표현해야 하지만 어떻게 수행하는지를 노출해서는 안 된다. 
메시지는 외부의 객체가 요청하는 무언가를 의미하기 때문에 메시지를 먼저 식별하면 무엇을 수행할지에 초점을 맞추는 인터페이스를 얻을 수 있다.

### 행동이 상태를 결정한다.
객체가 존재하는 이유는 협력에 참여하기 위해서다. 따라서 객체는 협력에 필요한 행동을 제공해야 한다.
객체를 객체답게 만드는 것은 객체의 상태가 아니라 객체가 다른 객체에게 제공하는 행동이다.

객체의 행동은 객체가 협력에 참여할 수 있는 유일한 방법이다. 객체의 상태가 아닌 행동에 초점을 맞춰야 한다.
협력 관계 속에서 다른 객체에게 무엇을 제공해야 하고 다른 객체로부터 무엇을 얻어야 하는지를 고민해야만 훌륭한 책임을 수확할 수 있다.
상태는 단지 객체가 행동을 정상적으로 수행하기 위해 필요한 재료일 뿐이다.

## 역할
객체가 어떤 특정한 협력 안에서 수행하는 책임의 집합을 `역할`이라고 부른다.

### 유연하고 재사용 가능한 협력
역할이 중요한 이유는 역할을 통해 유연하고 재사용 가능한 협력을 얻을 수 있기 때문이다.

Movie 와 DiscountPolicy 의 경우를 예로 들어보자.
만약 우리가 역할이라는 개념을 고려하지 않고 객체에게 책임을 할당한다고 가정해보자.
그렇다면 우리는 Movie 와 AmountDiscountPolicy, 그리고 Movie 와 PercentDiscountPolicy 라는 두 종류의 협력을 각각 만들었어야 했을 것이다.
이는 모든 문제의 근원인 코드 중복을 발생시킨다.

우리는 이러한 문제를 해결하기 위해 객체가 아닌 책임에 초점을 맞춰야 한다.
순수하게 책임의 관점에서 두 협력을 바라보면 AmountDiscountPolicy 와 PercentDiscountPolicy 모두 할인 요금 계산이라는 동일한 책임을 수행한다는 것을 알 수 있다.
따라서 이들을 하나로 통합할 수 있다.

이때 역할은 두 구체적인 객체를 포괄하는 `추상화`이다. 이를 통해 불필요한 중복 코드를 제거하고 더 유연한 협력이 가능해졌다.
새로운 할인 정책을 추가하기 위해 새로운 협력을 추가할 필요가 없어졌다. 그저 DiscountPolicy 역할을 수행할 수 있는 어떤 객체라도 이 협력에 참여할 수 있게 되었다.
따라서 역할과 책임을 중심으로 협력을 바라보는 것이 변경과 확장이 용이한 유연한 설계로 나아가는 첫 걸음이다.

역할을 구현하는 가장 일반적인 방법은 추상 클래스 혹은 인터페이스를 사용하는 것이다.

### 객체 대 역할
오직 한 종류의 객체만 협력에 참여하는 상황에서 역할이라는 개념은 어떨까? 오히려 복잡하게 만드는 요소일까? 
그땐 그냥 바로 객체를 대입해도 되지 않을까?

레베카 워프스브록은 협력에 참여하는 후보가 여러 종류의 객체에 의해 수행될 필요가 있다면 그 후보는 역할이 되지만
단지 한 종류의 객체만이 협력에 참여할 필요가 있다면 후보는 객체가 된다고 말했다.

```
협력(Collaboration) -reference-> 역할(Role) -select from-> 객체(Object) -instance of-> 클래스(Class)
```
트리그비 린스카우가 소개한 협력, 역할, 객체, 클래스의 관계이다.

어떤 시스템을 설계하는 초반에는 적절한 책임과 협력의 큰 그림을 탐색하는 것이 가장 중요한 목표여야 한다. 초반에는 많은 것들을 명확히 구분 짓기가 어렵다.
그래서 역할과 객체를 명확하게 구분짓는 것이 그리 중요하지 않다.

이후 필요한 순간마다 책임과 협력을 정제해가면서 필요한 순간에 객체로부터 역할을 분리해내는 것이 가장 좋은 방법이다.

### 역할과 추상화
추상화를 이용한 설계는 2가지 장점을 가진다. 첫째는 추상화 계층만을 이용하면 중요한 정책을 상위 수준에서 단순화할 수 있다는 것이다. 이를 통해 불필요한 세부 사항을 생략하고 핵심적인 개념을 강조할 수 있다.
둘째는 설계가 조금 더 유연해진다는 것이다.

역할은 공통의 책임을 바탕으로 객체의 종류를 숨기기 때문에 이런 관점에서 역할을 객체의 추상화로 볼 수 있다.

